
module type Password = sig
  password : Digest.t
end

module type Make(Password:Password) = struct

  type Session.session_data += Admin of Digest.t

  exception Login

  let check_session request =
    try
      let cookies, session = Session.check ~init:(fun _ -> raise Login) request in
      let sessid_server = match Session.get_session_data with
        | Admin d -> d
        | _       -> raise Login
      in
      let sessid_client =
        try Digest.from_hex (Cookies.get "sessid" cookies)
        with _ -> raise Login
      in

    with Login -> ...

end
